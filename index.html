<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BICI CHECK 4H</title>
    <style>
        :root { --p: #2563eb; --warn: #f59e0b; --danger: #ef4444; --safe: #22c55e; }
        
        body { 
            background: #1a1a1a; 
            margin: 0; 
            padding: 0; 
            display: flex; 
            justify-content: center; 
            color: #fff; 
            font-family: ui-sans-serif, system-ui, sans-serif;
        }

        .phone-container {
            width: 100%;
            max-width: 430px; 
            background: #000;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header { background: #111; padding: 12px; text-align: center; border-bottom: 1px solid #222; }
        .header h2 { margin: 0; font-size: 0.9rem; letter-spacing: 3px; color: #555; }

        #forecast-list { display: flex; flex-direction: column; }

        .hour-card { 
            display: flex; 
            align-items: center; 
            padding: 25px 15px; 
            border-bottom: 1px solid #1a1a1a; 
            border-left: 14px solid #333;
            background: #000;
        }
        
        .hour-time { 
            font-size: 1.1rem; 
            font-weight: 700; 
            min-width: 60px; 
            color: #666;
        }
        
        .main-temp { 
            min-width: 90px;
            text-align: center;
        }
        .temp-val { font-size: 3rem; font-weight: 900; line-height: 1; display: block; }
        .feel { font-size: 0.8rem; color: #555; font-weight: bold; }
        
        .weather-icon {
            flex-grow: 1;
            text-align: center;
            font-size: 3.5rem;
        }
        
        .stats { text-align: right; min-width: 100px; }
        .val { font-size: 1.8rem; font-weight: 900; display: block; line-height: 1; margin-bottom: 2px; }
        .label { font-size: 0.7rem; font-weight: 800; color: #444; text-transform: uppercase; display: block; }

        .wind { color: #3b82f6; }
        .rain { color: #22d3ee; }

        .risk-high { border-left-color: var(--danger); background: #120303; }
        .risk-med { border-left-color: var(--warn); background: #0f0b02; }
        .risk-low { border-left-color: var(--safe); }

        #loader { text-align: center; padding: 100px 20px; font-size: 1.2rem; color: #444; }
    </style>
</head>
<body onload="checkBici()">

<div class="phone-container">
    <div class="header">
        <h2>PREVISIÃ“N RUTA 4 HORAS</h2>
    </div>

    <div id="loader">SINCRONIZANDO...</div>
    <div id="forecast-list"></div>
</div>

<script>
const LAT = 40.33669864725108;
const LON = -3.8369067073823744;

const weatherIcons = {
    0: "â˜€ï¸", 1: "ğŸŒ¤ï¸", 2: "â›…", 3: "â˜ï¸", 45: "ğŸŒ«ï¸", 48: "ğŸŒ«ï¸",
    51: "ğŸŒ¦ï¸", 53: "ğŸŒ¦ï¸", 55: "ğŸŒ¦ï¸", 61: "ğŸŒ§ï¸", 63: "ğŸŒ§ï¸", 65: "ğŸŒ§ï¸",
    71: "â„ï¸", 80: "ğŸŒ§ï¸", 81: "ğŸŒ§ï¸", 82: "ğŸŒ§ï¸", 95: "â›ˆï¸"
};

async function checkBici() {
    try {
        const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&hourly=temperature_2m,apparent_temperature,precipitation_probability,wind_gusts_10m,weather_code&timezone=auto&forecast_days=1`);
        const data = await response.json();
        
        const currentHour = new Date().getHours();
        const list = document.getElementById('forecast-list');
        list.innerHTML = '';
        
        // Bucle limitado a las prÃ³ximas 4 horas
        for (let i = currentHour; i < currentHour + 4; i++) {
            const h = data.hourly;
            if (!h.time[i]) break;

            const time = h.time[i].split('T')[1];
            const temp = Math.round(h.temperature_2m[i]);
            const feel = Math.round(h.apparent_temperature[i]);
            const rain = h.precipitation_probability[i];
            const gusts = Math.round(h.wind_gusts_10m[i]);
            const code = h.weather_code[i];
            
            let riskClass = 'risk-low';
            if (gusts > 35 || rain > 40) riskClass = 'risk-high';
            else if (gusts > 22 || rain > 15) riskClass = 'risk-med';

            list.innerHTML += `
                <div class="hour-card ${riskClass}">
                    <div class="hour-time">${time}</div>
                    
                    <div class="main-temp">
                        <span class="temp-val">${temp}Â°</span>
                        <span class="feel">${feel}Â°S</span>
                    </div>

                    <div class="weather-icon">
                        ${weatherIcons[code] || "ğŸŒ¤ï¸"}
                    </div>

                    <div class="stats">
                        <span class="label">RACHA</span>
                        <span class="val wind">${gusts}</span>
                        <span class="label">LLUVIA</span>
                        <span class="val rain">${rain}%</span>
                    </div>
                </div>
            `;
        }
        document.getElementById('loader').style.display = 'none';
    } catch (err) {
        document.getElementById('loader').innerText = "ERROR DE CONEXIÃ“N";
    }
}
</script>

</body>
</html>