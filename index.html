<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BICI PLANNER PRO</title>
    <style>
        :root { --p: #2563eb; --warn: #f59e0b; --danger: #ef4444; --safe: #22c55e; }
        
        * { box-sizing: border-box; } /* Evita que los paddings ensanchen los elementos */

        body { 
            background: #000; 
            margin: 0; 
            padding: 0; 
            color: #fff; 
            font-family: ui-sans-serif, system-ui, sans-serif; 
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
        }
        
        .phone-container { 
            width: 100%; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            position: relative;
            max-width: 100%;
        }
        
        .header { 
            background: #111; 
            padding: 15px; 
            text-align: center; 
            border-bottom: 1px solid #222; 
        }
        .header h2 { margin: 0; font-size: 1rem; letter-spacing: 2px; color: #888; text-transform: uppercase; }

        .content-section { flex: 1; display: none; overflow: hidden; }
        .active-section { display: flex; flex-direction: column; }

        #forecast-list { height: 100%; display: flex; flex-direction: column; }

        .hour-card { 
            display: flex; 
            align-items: center; 
            padding: 0 15px; 
            border-bottom: 1px solid #1a1a1a; 
            border-left: 15px solid #333; 
            background: #000; 
            flex: 1; /* Esto obliga a las 5 filas a repartirse el alto total */
            gap: 10px;
            width: 100%;
        }
        
        .hour-time-box { width: 20%; }
        .main-temp { width: 25%; }
        .weather-icon { width: 20%; text-align: center; font-size: 3.5rem; } 
        .stats { width: 35%; text-align: right; display: flex; flex-direction: column; justify-content: center; }

        .hour-input, .hour-time { font-size: 1.4rem; font-weight: 900; color: #fff; border: none; background: transparent; width: 100%; }
        
        .temp-val { font-size: 3.5rem; font-weight: 900; line-height: 0.8; display: block; }
        .feel { font-size: 1.4rem; color: #aaa; font-weight: bold; }
        
        .val { font-size: 2.2rem; font-weight: 900; display: block; line-height: 0.9; }
        .label { font-size: 0.7rem; font-weight: 900; color: #555; text-transform: uppercase; }

        .wind-low { color: #22c55e; }
        .wind-mod { color: #f59e0b; }
        .wind-high { color: #ef4444; }
        .wind-extreme { color: #ec4899; }
        .rain { color: #22d3ee; }

        .risk-high { border-left-color: var(--danger); background: #120303; }
        .risk-med { border-left-color: var(--warn); background: #0f0b02; }
        .risk-low { border-left-color: var(--safe); }

        #section-map { width: 100%; height: 100%; }

        .nav-bar { 
            display: flex; 
            background: #111; 
            height: 80px; 
            padding-bottom: env(safe-area-inset-bottom); 
            border-top: 1px solid #222;
        }
        .nav-btn { flex: 1; border: none; background: none; color: #666; font-weight: 900; font-size: 1rem; text-transform: uppercase; cursor: pointer; }
        .nav-btn.active { color: #fff; border-top: 4px solid var(--p); background: #1a1a1a; }
    </style>
</head>
<body onload="init()">

<div class="phone-container">
    <div class="header"><h2>ALCORC√ìN BICI</h2></div>

    <div id="section-list" class="content-section active-section">
        <div id="forecast-list"></div>
    </div>

    <div id="section-map" class="content-section">
        <iframe id="windy-frame" src="https://embed.windy.com/embed2.html?lat=40.342&lon=-3.831&zoom=11&overlay=rain&product=ecmwf&metricWind=km/h&metricTemp=%C2%B0C" style="width:100%; height:100%; border:none;"></iframe>
    </div>

    <nav class="nav-bar">
        <button id="btn-datos" class="nav-btn active" onclick="showSection('datos')">üìä DATOS</button>
        <button id="btn-mapa" class="nav-btn" onclick="showSection('mapa')">üåç MAPA</button>
    </nav>
</div>

<script>
const LAT = 40.342, LON = -3.831;
let weatherData = null;
const weatherIcons = { 0: "‚òÄÔ∏è", 1: "üå§Ô∏è", 2: "‚õÖ", 3: "‚òÅÔ∏è", 45: "üå´Ô∏è", 51: "üå¶Ô∏è", 61: "üåßÔ∏è", 95: "‚õàÔ∏è" };

async function init() {
    const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&hourly=temperature_2m,apparent_temperature,precipitation,precipitation_probability,wind_speed_10m,wind_gusts_10m,weather_code&timezone=auto&forecast_days=2`);
    weatherData = await response.json();
    renderForecast(new Date().getHours().toString().padStart(2, '0') + ":00");
}

function showSection(s) {
    document.getElementById('section-list').style.display = s === 'datos' ? 'flex' : 'none';
    document.getElementById('section-map').style.display = s === 'mapa' ? 'block' : 'none';
    document.getElementById('btn-datos').classList.toggle('active', s === 'datos');
    document.getElementById('btn-mapa').classList.toggle('active', s === 'mapa');
}

function renderForecast(startTime) {
    const list = document.getElementById('forecast-list');
    let html = '';
    const h = weatherData.hourly;
    let idx = h.time.findIndex(t => t.includes(`T${startTime.split(':')[0]}:00`));
    if (idx === -1) idx = 0;

    for (let i = idx; i < idx + 5; i++) {
        if (!h.time[i]) break;
        const time = h.time[i].split('T')[1], temp = Math.round(h.temperature_2m[i]), 
              feel = Math.round(h.apparent_temperature[i]), prob = h.precipitation_probability[i],
              rain = h.precipitation[i], wind = Math.round(h.wind_speed_10m[i]), gusts = Math.round(h.wind_gusts_10m[i]);

        let wCol = wind > 30 ? 'wind-extreme' : wind > 20 ? 'wind-high' : wind > 12 ? 'wind-mod' : 'wind-low';
        let risk = (gusts > 35 || prob > 40) ? 'risk-high' : (gusts > 22 || prob > 15) ? 'risk-med' : 'risk-low';

        html += `
            <div class="hour-card ${risk}">
                <div class="hour-time-box">${i===idx ? `<input type="time" class="hour-input" value="${time}" onchange="renderForecast(this.value)">` : `<div class="hour-time">${time}</div>`}</div>
                <div class="main-temp"><span class="temp-val">${temp}¬∞</span><span class="feel">${feel}¬∞</span></div>
                <div class="weather-icon">${weatherIcons[h.weather_code[i]] || "üå§Ô∏è"}</div>
                <div class="stats">
                    <span class="label">VIENTO</span><span class="val ${wCol}">${wind}<small style="font-size:0.5em">(${gusts})</small></span>
                    <span class="label">LLUVIA</span><span class="val rain">${rain > 0 ? rain : prob+'%'}</span>
                </div>
            </div>`;
    }
    list.innerHTML = html;
}
</script>
</body>
</html>