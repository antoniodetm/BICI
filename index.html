<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BICI PLANNER 5H - ALCORC√ìN</title>
    <style>
        :root { --p: #2563eb; --warn: #f59e0b; --danger: #ef4444; --safe: #22c55e; }
        body { background: #1a1a1a; margin: 0; padding: 0; display: flex; justify-content: center; color: #fff; font-family: ui-sans-serif, system-ui, sans-serif; overflow: hidden; height: 100vh; }
        
        .phone-container { width: 100%; max-width: 430px; background: #000; height: 100vh; display: flex; flex-direction: column; position: relative; }
        
        .header { background: #111; padding: 8px; text-align: center; border-bottom: 1px solid #222; }
        .header h2 { margin: 0; font-size: 0.7rem; letter-spacing: 2px; color: #555; text-transform: uppercase; }

        .content-section { flex-grow: 1; display: none; height: calc(100vh - 110px); }
        .active-section { display: flex; flex-direction: column; }

        #forecast-list { display: flex; flex-direction: column; height: 100%; justify-content: space-between; }

        /* PADDING REDUCIDO PARA EVITAR SCROLL */
        .hour-card { 
            display: flex; align-items: center; 
            padding: 10px 8px; /* Reducido al m√≠nimo */
            border-bottom: 1px solid #1a1a1a; 
            border-left: 10px solid #333; 
            background: #000; 
            gap: 6px;
            flex: 1; /* Esto hace que las 5 filas se repartan el espacio exacto */
        }
        
        .hour-time-box { min-width: 60px; }
        .main-temp { min-width: 70px; text-align: left; }
        .weather-icon { width: 60px; text-align: left; font-size: 3.2rem; line-height: 1; } 
        
        .hour-input { 
            background: #111; color: #fff; border: 1px solid #333; font-size: 0.9rem; 
            font-weight: 700; width: 100%; padding: 2px; border-radius: 4px; color-scheme: dark;
        }

        .hour-time { font-size: 0.9rem; font-weight: 700; color: #666; }
        .temp-val { font-size: 2.2rem; font-weight: 900; line-height: 0.9; display: block; }
        .feel { font-size: 1.1rem; color: #888; font-weight: bold; display: block; }
        
        .stats { margin-left: auto; text-align: right; min-width: 85px; }
        .val { font-size: 1.4rem; font-weight: 900; display: block; line-height: 1; }
        .label { font-size: 0.6rem; font-weight: 800; color: #444; text-transform: uppercase; }

        .wind { color: #3b82f6; }
        .rain { color: #22d3ee; }

        .risk-high { border-left-color: var(--danger); background: #120303; }
        .risk-med { border-left-color: var(--warn); background: #0f0b02; }
        .risk-low { border-left-color: var(--safe); }

        .nav-bar { display: flex; background: #111; border-top: 1px solid #222; height: 55px; }
        .nav-btn { flex: 1; border: none; background: none; color: #555; font-size: 0.7rem; text-transform: uppercase; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .nav-btn.active { color: #fff; border-top: 2px solid var(--p); }

        #loader { text-align: center; padding: 20px; color: #444; }
    </style>
</head>
<body onload="init()">

<div class="phone-container">
    <div class="header">
        <h2 id="view-title">DATOS ALCORC√ìN</h2>
    </div>

    <div id="section-list" class="content-section active-section">
        <div id="loader">CARGANDO...</div>
        <div id="forecast-list"></div>
    </div>

    <nav class="nav-bar">
        <button class="nav-btn active" onclick="showView('list', this)"><span>üìä Datos</span></button>
        <button class="nav-btn" onclick="location.reload()"><span>üîÑ Cargar</span></button>
    </nav>
</div>

<script>
const LAT = 40.342;
const LON = -3.831;
let weatherData = null;

const weatherIcons = {
    0: "‚òÄÔ∏è", 1: "üå§Ô∏è", 2: "‚õÖ", 3: "‚òÅÔ∏è", 45: "üå´Ô∏è", 48: "üå´Ô∏è",
    51: "üå¶Ô∏è", 53: "üå¶Ô∏è", 55: "üå¶Ô∏è", 61: "üåßÔ∏è", 63: "üåßÔ∏è", 65: "üåßÔ∏è",
    71: "‚ùÑÔ∏è", 80: "üåßÔ∏è", 81: "üåßÔ∏è", 82: "üåßÔ∏è", 95: "‚õàÔ∏è"
};

async function init() {
    try {
        const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&hourly=temperature_2m,apparent_temperature,precipitation,precipitation_probability,wind_speed_10m,wind_gusts_10m,weather_code&timezone=auto&forecast_days=2`);
        weatherData = await response.json();
        const now = new Date();
        const currentHour = now.getHours().toString().padStart(2, '0') + ":00";
        renderForecast(currentHour);
        document.getElementById('loader').style.display = 'none';
    } catch (e) { document.getElementById('loader').innerText = "ERROR"; }
}

function renderForecast(startTime) {
    const list = document.getElementById('forecast-list');
    let htmlContent = '';
    const times = weatherData.hourly.time;
    const normalizedTime = startTime.includes(':') ? startTime.split(':')[0] + ":00" : startTime;
    let startIndex = times.findIndex(t => t.includes(`T${normalizedTime}`));
    if (startIndex === -1) startIndex = 0;

    for (let i = startIndex; i < startIndex + 5; i++) {
        const h = weatherData.hourly;
        if (!h || !h.time[i]) break;
        const timeStr = h.time[i].split('T')[1];
        const temp = Math.round(h.temperature_2m[i]);
        const feel = Math.round(h.apparent_temperature[i]);
        const rainProb = h.precipitation_probability[i];
        const rainAmount = h.precipitation[i].toFixed(1);
        const windSpeed = Math.round(h.wind_speed_10m[i]); 
        const gusts = Math.round(h.wind_gusts_10m[i]);
        const code = h.weather_code[i];
        
        let riskClass = 'risk-low';
        if (gusts > 35 || rainProb > 40 || rainAmount > 0.8) riskClass = 'risk-high';
        else if (gusts > 22 || rainProb > 15 || rainAmount > 0.1) riskClass = 'risk-med';

        const timeContent = (i === startIndex) 
            ? `<input type="time" class="hour-input" value="${timeStr}" onchange="renderForecast(this.value)">`
            : `<div class="hour-time">${timeStr}</div>`;

        htmlContent += `
            <div class="hour-card ${riskClass}">
                <div class="hour-time-box">${timeContent}</div>
                <div class="main-temp">
                    <span class="temp-val">${temp}¬∞</span>
                    <span class="feel">${feel}¬∞</span>
                </div>
                <div class="weather-icon">${weatherIcons[code] || "üå§Ô∏è"}</div>
                <div class="stats">
                    <span class="label">VIENTO</span>
                    <span class="val wind">${windSpeed}<small style="font-size:0.6em">(${gusts})</small></span>
                    <span class="label">LLUVIA</span>
                    <span class="val rain">${rainProb}%<small style="font-size:0.6em">${rainAmount}</small></span>
                </div>
            </div>`;
    }
    list.innerHTML = htmlContent;
}
</script>
</body>
</html>