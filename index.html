<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BICI PLANNER 5H</title>
    <style>
        :root { --p: #2563eb; --warn: #f59e0b; --danger: #ef4444; --safe: #22c55e; }
        body { background: #1a1a1a; margin: 0; padding: 0; display: flex; justify-content: center; color: #fff; font-family: ui-sans-serif, system-ui, sans-serif; }
        
        .phone-container { width: 100%; max-width: 430px; background: #000; min-height: 100vh; display: flex; flex-direction: column; }
        
        .header { background: #111; padding: 12px; text-align: center; border-bottom: 1px solid #222; }
        .header h2 { margin: 0; font-size: 0.8rem; letter-spacing: 2px; color: #555; text-transform: uppercase; }

        .hour-card { display: flex; align-items: center; padding: 25px 15px; border-bottom: 1px solid #1a1a1a; border-left: 14px solid #333; background: #000; }
        
        /* Ajuste preciso para que la primera hora se vea completa */
        .hour-time-box { min-width: 85px; display: flex; align-items: center; }
        
        .hour-input { 
            background: #111; color: #fff; border: 1px solid #333; font-size: 1.1rem; 
            font-weight: 700; width: 100%; padding: 4px; border-radius: 5px; font-family: inherit;
            -webkit-appearance: none; /* Quita estilos por defecto en iPhone */
        }
        
        .hour-time { font-size: 1.1rem; font-weight: 700; color: #666; }
        
        .main-temp { min-width: 90px; text-align: center; }
        .temp-val { font-size: 3rem; font-weight: 900; line-height: 1; display: block; }
        .feel { font-size: 0.8rem; color: #555; font-weight: bold; }
        
        .weather-icon { flex-grow: 1; text-align: center; font-size: 3.5rem; }
        
        .stats { text-align: right; min-width: 100px; }
        .val { font-size: 1.8rem; font-weight: 900; display: block; line-height: 1; margin-bottom: 2px; }
        .label { font-size: 0.7rem; font-weight: 800; color: #444; text-transform: uppercase; display: block; }

        .wind { color: #3b82f6; }
        .rain { color: #22d3ee; }

        .risk-high { border-left-color: var(--danger); background: #120303; }
        .risk-med { border-left-color: var(--warn); background: #0f0b02; }
        .risk-low { border-left-color: var(--safe); }
        #loader { text-align: center; padding: 100px 20px; color: #444; }
    </style>
</head>
<body onload="init()">

<div class="phone-container">
    <div class="header">
        <h2>PREVISI√ìN RUTA 5 HORAS</h2>
    </div>
    <div id="loader">CARGANDO...</div>
    <div id="forecast-list"></div>
</div>

<script>
const LAT = 40.33669864725108;
const LON = -3.8369067073823744;
let weatherData = null;

const weatherIcons = {
    0: "‚òÄÔ∏è", 1: "üå§Ô∏è", 2: "‚õÖ", 3: "‚òÅÔ∏è", 45: "üå´Ô∏è", 48: "üå´Ô∏è",
    51: "üå¶Ô∏è", 53: "üå¶Ô∏è", 55: "üå¶Ô∏è", 61: "üåßÔ∏è", 63: "üåßÔ∏è", 65: "üåßÔ∏è",
    71: "‚ùÑÔ∏è", 80: "üåßÔ∏è", 81: "üåßÔ∏è", 82: "üåßÔ∏è", 95: "‚õàÔ∏è"
};

async function init() {
    try {
        const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&hourly=temperature_2m,apparent_temperature,precipitation_probability,wind_gusts_10m,weather_code&timezone=auto&forecast_days=2`);
        weatherData = await response.json();
        
        const now = new Date();
        const currentHour = now.getHours().toString().padStart(2, '0') + ":00";
        renderForecast(currentHour);
        
        document.getElementById('loader').style.display = 'none';
    } catch (e) { document.getElementById('loader').innerText = "ERROR API"; }
}

function renderForecast(startTime) {
    const list = document.getElementById('forecast-list');
    list.innerHTML = '';
    
    const times = weatherData.hourly.time;
    let startIndex = times.findIndex(t => t.includes(`T${startTime}`));
    
    if (startIndex === -1) {
        const hourOnly = startTime.split(':')[0];
        startIndex = times.findIndex(t => t.includes(`T${hourOnly}:00`));
    }

    for (let i = startIndex; i < startIndex + 5; i++) {
        const h = weatherData.hourly;
        if (!h || !h.time[i]) break;

        const timeStr = h.time[i].split('T')[1];
        const temp = Math.round(h.temperature_2m[i]);
        const feel = Math.round(h.apparent_temperature[i]);
        const rain = h.precipitation_probability[i];
        const gusts = Math.round(h.wind_gusts_10m[i]);
        const code = h.weather_code[i];
        
        let riskClass = 'risk-low';
        if (gusts > 35 || rain > 40) riskClass = 'risk-high';
        else if (gusts > 22 || rain > 15) riskClass = 'risk-med';

        const timeContent = (i === startIndex) 
            ? `<input type="time" class="hour-input" value="${timeStr}" onchange="renderForecast(this.value)">`
            : `<div class="hour-time">${timeStr}</div>`;

        list.innerHTML += `
            <div class="hour-card ${riskClass}">
                <div class="hour-time-box">${timeContent}</div>
                <div class="main-temp">
                    <span class="temp-val">${temp}¬∞</span>
                    <span class="feel">${feel}¬∞S</span>
                </div>
                <div class="weather-icon">${weatherIcons[code] || "üå§Ô∏è"}</div>
                <div class="stats">
                    <span class="label">RACHA</span>
                    <span class="val wind">${gusts}</span>
                    <span class="label">LLUVIA</span>
                    <span class="val rain">${rain}%</span>
                </div>
            </div>
        `;
    }
}
</script>
</body>
</html>