<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BICI PLANNER PRO - ALCORC√ìN</title>
    <style>
        :root { --p: #2563eb; --warn: #f59e0b; --danger: #ef4444; --safe: #22c55e; }
        
        /* Ajuste para ocupar el 100% de resoluciones altas */
        body { 
            background: #000; 
            margin: 0; 
            padding: 0; 
            display: flex; 
            justify-content: center; 
            color: #fff; 
            font-family: ui-sans-serif, system-ui, sans-serif; 
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
        }
        
        .phone-container { 
            width: 100%; 
            max-width: 100%; /* Ahora ignora el l√≠mite de 430px */
            background: #000; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            position: relative; 
        }
        
        .header { 
            background: #111; 
            padding: 20px; 
            text-align: center; 
            border-bottom: 1px solid #222; 
            z-index: 10; 
        }
        .header h2 { 
            margin: 0; 
            font-size: 1.2rem; 
            letter-spacing: 4px; 
            color: #888; 
            text-transform: uppercase; 
            font-weight: 900; 
        }

        .content-section { flex-grow: 1; display: none; height: calc(100vh - 160px); }
        .active-section { display: flex; flex-direction: column; }

        #forecast-list { 
            display: flex; 
            flex-direction: column; 
            height: 100%; 
            justify-content: stretch; 
        }

        .hour-card { 
            display: flex; 
            align-items: center; 
            padding: 10px 25px; 
            border-bottom: 1px solid #1a1a1a; 
            border-left: 25px solid #333; 
            background: #000; 
            gap: 20px;
            flex: 1; 
        }
        
        .hour-time-box { min-width: 100px; text-align: left; }
        .main-temp { min-width: 140px; text-align: left; }
        .weather-icon { width: 110px; text-align: center; font-size: 5.5rem; line-height: 1; } 

        .hour-input { 
            background: transparent; 
            color: #fff; 
            border: none; 
            font-size: 1.8rem; 
            font-weight: 900; 
            width: 100%; 
            padding: 0; 
            color-scheme: dark;
            font-family: inherit;
        }
        .hour-input::-webkit-calendar-picker-indicator { display: none !important; }

        .hour-time { font-size: 1.8rem; font-weight: 900; color: #fff; }
        .temp-val { font-size: 4.5rem; font-weight: 900; line-height: 0.85; display: block; letter-spacing: -2px; }
        .feel { font-size: 1.8rem; color: #aaa; font-weight: bold; margin-top: 5px; display: block; }
        
        .stats { margin-left: auto; text-align: right; min-width: 180px; display: flex; flex-direction: column; justify-content: center; }
        .val { font-size: 3.2rem; font-weight: 900; display: block; line-height: 0.8; margin-bottom: 8px; }
        .label { font-size: 1rem; font-weight: 900; color: #555; text-transform: uppercase; line-height: 1; margin-bottom: 4px; }

        /* Colores Viento con Intensidad */
        .wind-low { color: #22c55e; }
        .wind-mod { color: #f59e0b; }
        .wind-high { color: #ef4444; }
        .wind-extreme { color: #ec4899; }
        
        .rain { color: #22d3ee; }
        .prob-style { font-size: 0.5em; font-weight: 900; opacity: 0.8; margin-left: 5px; }

        .risk-high { border-left-color: var(--danger); background: #1a0505; }
        .risk-med { border-left-color: var(--warn); background: #110d02; }
        .risk-low { border-left-color: var(--safe); }

        #section-map { width: 100%; height: calc(100vh - 160px); background: #000; overflow: hidden; }

        .nav-bar { 
            display: flex; 
            background: #111; 
            border-top: 1px solid #222; 
            height: 90px; 
            padding-bottom: env(safe-area-inset-bottom); 
        }
        .nav-btn { 
            flex: 1; 
            border: none; 
            background: none; 
            color: #666; 
            font-weight: 900; 
            font-size: 1.1rem; 
            text-transform: uppercase; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
        }
        .nav-btn.active { color: #fff; background: #1a1a1a; border-top: 6px solid var(--p); }

        #loader { text-align: center; padding: 100px; color: #444; font-weight: bold; font-size: 2rem; }
    </style>
</head>
<body onload="init()">

<div class="phone-container">
    <div class="header">
        <h2 id="view-title">ALCORC√ìN BICI PRO</h2>
    </div>

    <div id="section-list" class="content-section active-section">
        <div id="loader">CARGANDO...</div>
        <div id="forecast-list"></div>
    </div>

    <div id="section-map" class="content-section">
        <iframe 
            id="windy-frame"
            src="https://embed.windy.com/embed2.html?lat=40.342&lon=-3.831&zoom=11&level=surface&overlay=rain&product=ecmwf&menu=&message=&marker=true&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=km/h&metricTemp=%C2%B0C&radarRange=-1" 
            style="width:100%; height:100%; border:none;">
        </iframe>
    </div>

    <nav class="nav-bar">
        <button id="btn-datos" class="nav-btn active" onclick="showSection('datos')">üìä DATOS</button>
        <button id="btn-mapa" class="nav-btn" onclick="showSection('mapa')">üåç MAPA</button>
    </nav>
</div>

<script>
const LAT = 40.342;
const LON = -3.831;
let weatherData = null;

const weatherIcons = {
    0: "‚òÄÔ∏è", 1: "üå§Ô∏è", 2: "‚õÖ", 3: "‚òÅÔ∏è", 45: "üå´Ô∏è", 48: "üå´Ô∏è",
    51: "üå¶Ô∏è", 53: "üå¶Ô∏è", 55: "üå¶Ô∏è", 61: "üåßÔ∏è", 63: "üåßÔ∏è", 65: "üåßÔ∏è",
    71: "‚ùÑÔ∏è", 80: "üåßÔ∏è", 81: "üåßÔ∏è", 82: "üåßÔ∏è", 95: "‚õàÔ∏è"
};

async function init() {
    try {
        const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&hourly=temperature_2m,apparent_temperature,precipitation,precipitation_probability,wind_speed_10m,wind_gusts_10m,weather_code&timezone=auto&forecast_days=2`);
        weatherData = await response.json();
        const now = new Date();
        const currentHour = now.getHours().toString().padStart(2, '0') + ":00";
        renderForecast(currentHour);
        document.getElementById('loader').style.display = 'none';
    } catch (e) { 
        document.getElementById('loader').innerText = "ERROR API"; 
    }
}

function showSection(section) {
    const listSection = document.getElementById('section-list');
    const mapSection = document.getElementById('section-map');
    const btnDatos = document.getElementById('btn-datos');
    const btnMapa = document.getElementById('btn-mapa');
    const title = document.getElementById('view-title');

    if (section === 'datos') {
        listSection.style.display = 'flex';
        mapSection.style.display = 'none';
        btnDatos.classList.add('active');
        btnMapa.classList.remove('active');
        title.innerText = "ALCORC√ìN BICI PRO";
    } else {
        listSection.style.display = 'none';
        mapSection.style.display = 'block';
        btnDatos.classList.remove('active');
        btnMapa.classList.add('active');
        title.innerText = "RADAR EN VIVO";
    }
}

function renderForecast(startTime) {
    const list = document.getElementById('forecast-list');
    let htmlContent = '';
    const h = weatherData.hourly;
    
    const normalizedTime = startTime.includes(':') ? startTime.split(':')[0] + ":00" : startTime;
    let startIndex = h.time.findIndex(t => t.includes(`T${normalizedTime}`));
    
    if (startIndex === -1) startIndex = 0;

    for (let i = startIndex; i < startIndex + 5; i++) {
        if (!h.time[i]) break;
        const timeStr = h.time[i].split('T')[1];
        const temp = Math.round(h.temperature_2m[i]);
        const feel = Math.round(h.apparent_temperature[i]);
        const rainProb = h.precipitation_probability[i];
        const rainValue = h.precipitation[i];
        const windSpeed = Math.round(h.wind_speed_10m[i]); 
        const gusts = Math.round(h.wind_gusts_10m[i]);
        const code = h.weather_code[i];
        
        let rainHTML = "";
        if (rainValue > 0) {
            rainHTML = `${rainValue.toFixed(1)}<small class="prob-style">${rainProb}%</small>`;
        } else {
            rainHTML = rainProb > 0 ? `<span style="font-size:0.9em">--</span><small class="prob-style">${rainProb}%</small>` : "0%";
        }

        // L√≥gica de colores para el viento
        let windColorClass = 'wind-low';
        if (gusts > 50 || windSpeed > 30) windColorClass = 'wind-extreme';
        else if (gusts > 35 || windSpeed > 20) windColorClass = 'wind-high';
        else if (gusts > 22 || windSpeed > 12) windColorClass = 'wind-mod';

        let riskClass = 'risk-low';
        if (gusts > 35 || rainProb > 40 || rainValue > 0.8) riskClass = 'risk-high';
        else if (gusts > 22 || rainProb > 15 || rainValue > 0.1) riskClass = 'risk-med';

        const timeContent = (i === startIndex) 
            ? `<input type="time" class="hour-input" value="${timeStr}" onchange="renderForecast(this.value)">`
            : `<div class="hour-time">${timeStr}</div>`;

        htmlContent += `
            <div class="hour-card ${riskClass}">
                <div class="hour-time-box">${timeContent}</div>
                <div class="main-temp">
                    <span class="temp-val">${temp}¬∞</span>
                    <span class="feel">${feel}¬∞</span>
                </div>
                <div class="weather-icon">${weatherIcons[code] || "üå§Ô∏è"}</div>
                <div class="stats">
                    <span class="label">VIENTO (KM/H)</span>
                    <span class="val wind ${windColorClass}">${windSpeed}<small style="font-size:0.45em; font-weight:900; opacity:0.7"> (${gusts})</small></span>
                    <span class="label">LLUVIA</span>
                    <span class="val rain">${rainHTML}</span>
                </div>
            </div>`;
    }
    list.innerHTML = htmlContent;
}
</script>
</body>
</html>