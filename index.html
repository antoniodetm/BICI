<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BICI PLANNER PRO</title>
    <style>
        :root { --p: #2563eb; --warn: #f59e0b; --danger: #ef4444; --safe: #22c55e; }
        * { box-sizing: border-box; } 

        body { 
            background: #000; 
            margin: 0; padding: 0; 
            color: #fff; 
            font-family: ui-sans-serif, system-ui, sans-serif; 
            overflow: hidden; 
            height: 100vh; width: 100vw;
            display: flex; justify-content: center;
        }
        
        .phone-container { width: 100%; height: 100vh; display: flex; flex-direction: column; }
        .header { background: #111; padding: 10px; text-align: center; border-bottom: 1px solid #222; }
        .header h2 { margin: 0; font-size: 0.8rem; letter-spacing: 2px; color: #555; text-transform: uppercase; }

        .content-section { flex: 1; display: none; overflow: hidden; }
        .active-section { display: flex; flex-direction: column; }
        #forecast-list { height: 100%; display: flex; flex-direction: column; }

        .hour-card { 
            display: flex; 
            align-items: center; 
            padding: 0 15px; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); 
            border-left: 4px solid #333; 
            background: #000; 
            flex: 1; 
            width: 100%;
            justify-content: space-between;
        }
        
        .hour-time-box { width: 18%; }
        .main-temp { width: 22%; display: flex; flex-direction: column; align-items: flex-start; }
        
        .weather-icon { 
            flex: 1;
            text-align: center; 
            font-size: 3.8rem; 
        } 

        .stats { 
            width: 38%; 
            text-align: right; 
            display: flex; 
            flex-direction: column; 
            justify-content: center;
            min-height: 80px;
        }

        .hour-input, .hour-time { font-size: 1.2rem; font-weight: 900; color: #fff; border: none; background: transparent; width: 100%; outline: none; }
        
        .temp-val { font-size: 3.2rem; font-weight: 900; line-height: 0.75; display: block; letter-spacing: -2px; }
        .feel { font-size: 1.6rem; color: rgba(255,255,255,0.7); font-weight: 900; margin-top: 4px; }
        
        .val { font-size: 2.8rem; font-weight: 900; display: block; line-height: 0.75; letter-spacing: -1px; }
        .label { font-size: 0.7rem; font-weight: 900; color: #444; text-transform: uppercase; margin-top: 2px; }

        .wind-low { color: #22c55e; }
        .wind-mod { color: #f59e0b; }
        .wind-high { color: #ef4444; }
        .wind-extreme { color: #ec4899; }
        .rain-val { color: #22d3ee; }

        .risk-high { border-left-color: var(--danger); background: #150505; }
        .risk-med { border-left-color: var(--warn); background: #110d02; }
        .risk-low { border-left-color: var(--safe); }

        /* Estilos para la lluvia: mm a la izquierda con n√∫mero un poco m√°s grande */
        .mm-container { opacity: 0.7; margin-right: 6px; vertical-align: middle; }
        .mm-num { font-size: 0.45em; font-weight: 800; }
        .mm-unit { font-size: 0.25em; font-weight: 400; margin-left: 1px; }

        .nav-bar { display: flex; background: #111; height: 85px; border-top: 1px solid #222; }
        .nav-btn { flex: 1; border: none; background: none; color: #444; font-weight: 900; font-size: 1rem; text-transform: uppercase; }
        .nav-btn.active { color: #fff; border-top: 4px solid var(--p); background: #1a1a1a; }
    </style>
</head>
<body onload="init()">

<div class="phone-container">
    <div class="header"><h2>ALCORC√ìN BICI PRO</h2></div>
    <div id="section-list" class="content-section active-section"><div id="forecast-list"></div></div>
    <div id="section-map" class="content-section">
        <iframe id="windy-frame" src="https://embed.windy.com/embed2.html?lat=40.342&lon=-3.831&zoom=11&overlay=rain&product=ecmwf&metricWind=km/h&metricTemp=%C2%B0C" style="width:100%; height:100%; border:none;"></iframe>
    </div>
    <nav class="nav-bar">
        <button id="btn-datos" class="nav-btn active" onclick="showSection('datos')">üìä DATOS</button>
        <button id="btn-mapa" class="nav-btn" onclick="showSection('mapa')">üåç MAPA</button>
    </nav>
</div>

<script>
const LAT = 40.342, LON = -3.831;
let weatherData = null;

const weatherIcons = {
    0: "‚òÄÔ∏è", 1: "üå§Ô∏è", 2: "‚õÖ", 3: "‚òÅÔ∏è", 45: "üå´Ô∏è", 48: "üå´Ô∏è", 
    51: "üå¶Ô∏è", 53: "üå¶Ô∏è", 55: "üåßÔ∏è", 61: "üåßÔ∏è", 63: "üåßÔ∏è", 65: "üåßÔ∏è", 
    71: "‚ùÑÔ∏è", 73: "‚ùÑÔ∏è", 75: "‚ùÑÔ∏è", 77: "‚ùÑÔ∏è", 80: "üå¶Ô∏è", 81: "üåßÔ∏è", 
    82: "‚õàÔ∏è", 85: "‚ùÑÔ∏è", 86: "‚ùÑÔ∏è", 95: "‚õàÔ∏è", 96: "‚õàÔ∏è", 99: "‚õàÔ∏è"
};

async function init() {
    try {
        const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&hourly=temperature_2m,apparent_temperature,precipitation,precipitation_probability,wind_speed_10m,wind_gusts_10m,weather_code&timezone=auto&forecast_days=2`);
        weatherData = await response.json();
        renderForecast(new Date().getHours().toString().padStart(2, '0') + ":00");
    } catch(e) { console.error("Error al obtener datos"); }
}

function showSection(s) {
    document.getElementById('section-list').style.display = s === 'datos' ? 'flex' : 'none';
    document.getElementById('section-map').style.display = s === 'mapa' ? 'block' : 'none';
    document.getElementById('btn-datos').classList.toggle('active', s === 'datos');
    document.getElementById('btn-mapa').classList.toggle('active', s === 'mapa');
}

function renderForecast(startTime) {
    const list = document.getElementById('forecast-list');
    let html = '';
    const h = weatherData.hourly;
    let idx = h.time.findIndex(t => t.includes(`T${startTime.split(':')[0]}:00`));
    if (idx === -1) idx = 0;

    for (let i = idx; i < idx + 5; i++) {
        if (!h.time[i]) break;
        const time = h.time[i].split('T')[1], 
              temp = Math.round(h.temperature_2m[i]), 
              feel = Math.round(h.apparent_temperature[i]), 
              prob = h.precipitation_probability[i],
              rain = h.precipitation[i], 
              wind = Math.round(h.wind_speed_10m[i]), 
              gusts = Math.round(h.wind_gusts_10m[i]);

        let wCol = wind > 30 ? 'wind-extreme' : wind > 20 ? 'wind-high' : wind > 12 ? 'wind-mod' : 'wind-low';
        let risk = (gusts > 35 || prob > 40 || rain > 0.8) ? 'risk-high' : (gusts > 22 || prob > 15 || rain > 0.1) ? 'risk-med' : 'risk-low';

        let rainDisplay = '';
        if (rain > 0) {
            rainDisplay += `<span class="mm-container"><span class="mm-num">${rain.toFixed(1)}</span><span class="mm-unit">mm</span></span>`;
        }
        if (prob > 0) {
            rainDisplay += `${prob}%`;
        }

        let rainBlock = (rainDisplay !== '') ? `
            <span class="label">LLUVIA</span>
            <span class="val rain-val">${rainDisplay}</span>
        ` : '';

        html += `
            <div class="hour-card ${risk}">
                <div class="hour-time-box">
                    ${i===idx ? `<input type="time" class="hour-input" value="${time}" onchange="renderForecast(this.value)">` : `<div class="hour-time">${time}</div>`}
                </div>
                <div class="main-temp">
                    <span class="temp-val">${temp}¬∞</span>
                    <span class="feel">${feel}¬∞</span>
                </div>
                <div class="weather-icon">${weatherIcons[h.weather_code[i]] || "üå§Ô∏è"}</div>
                <div class="stats">
                    <span class="label">VIENTO</span>
                    <span class="val ${wCol}">${wind}<small style="font-size:0.4em; opacity:0.5; vertical-align:middle"> (${gusts})</small></span>
                    ${rainBlock}
                </div>
            </div>`;
    }
    list.innerHTML = html;
}
</script>
</body>
</html>