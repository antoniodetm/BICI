<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BICI PLANNER PRO</title>
    <style>
        :root { 
            --bg-safe: #4ade80; 
            --bg-warn: #facc15; 
            --bg-danger: #ef4444; 
        }
        * { box-sizing: border-box; } 

        body { 
            background: #ffffff; 
            margin: 0; padding: 5px; 
            color: #000; 
            font-family: 'Arial Black', Gadget, sans-serif; 
            height: 100vh; width: 100vw;
            display: flex; justify-content: center;
            overflow: hidden;
        }
        
        .phone-container { width: 100%; height: 100%; display: flex; flex-direction: column; }

        .header { background: #000; padding: 8px; text-align: center; border-radius: 12px 12px 0 0; }
        .header h2 { margin: 0; font-size: 1.2rem; color: #fff; text-transform: uppercase; }

        #forecast-list { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            gap: 4px; 
            overflow-y: auto; 
            margin-bottom: 0; 
        }

        .hour-card { 
            display: grid;
            grid-template-columns: 85px 1fr 1fr 1fr;
            gap: 6px;
            padding: 8px 10px;
            border-radius: 15px;
            min-height: 110px;
        }
        
        .risk-low { background-color: var(--bg-safe); }
        .risk-med { background-color: var(--bg-warn); }
        .risk-high { background-color: var(--bg-danger); }

        .data-block {
            background: #000; 
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 4px 2px 6px 2px;
            color: #fff;
        }

        .time-block input, .time-block span { 
            font-family: 'Arial Black', Gadget, sans-serif;
            font-size: 1.2rem; font-weight: 900; color: #fff; 
            background: transparent; border: none; width: 100%; text-align: center;
            padding: 0; margin: 0; display: block;
            -webkit-appearance: none; appearance: none;
        }
        .time-block input::-webkit-calendar-picker-indicator { display: none !important; }

        .label { font-size: 0.6rem; font-weight: 900; color: #888; text-transform: uppercase; }
        .val-big { font-size: 2.4rem; font-weight: 900; line-height: 0.8; letter-spacing: -1px; }
        .val-small { font-size: 1.2rem; font-weight: 900; }
        .weather-icon { font-size: 2.4rem; line-height: 1; margin-bottom: 2px; }

        /* NAVEGACI√ìN M√ÅS ESTRECHA */
        .nav-bar { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 4px; 
            padding: 4px 0 0 0; /* Espacio m√≠nimo arriba */
            background: #fff;
        }
        
        .nav-btn { 
            background: #000; border: none; border-radius: 10px; 
            color: #fff; font-weight: 900; font-size: 1.1rem; 
            padding: 10px; /* Reducido de 18px a 10px */
            text-transform: uppercase;
        }
        .nav-btn.active { 
            background: #fff; color: #000; border: 3px solid #000; 
            padding: 7px; /* Compensaci√≥n por el borde */
        }

        .content-section { flex: 1; display: none; overflow: hidden; }
        .active-section { display: flex; flex-direction: column; }
        #section-map { border-radius: 0 0 15px 15px; border: 4px solid #000; height: 100%; }
    </style>
</head>
<body onload="init()">

<div class="phone-container">
    <div class="header"><h2>PREVISI√ìN BICI</h2></div>
    
    <div id="section-list" class="content-section active-section">
        <div id="forecast-list"></div>
    </div>

    <div id="section-map" class="content-section">
        <iframe id="windy-frame" src="https://embed.windy.com/embed2.html?lat=40.342&lon=-3.831&zoom=11&overlay=rain&product=ecmwf&metricWind=km/h&metricTemp=%C2%B0C" style="width:100%; height:100%; border:none;"></iframe>
    </div>

    <nav class="nav-bar">
        <button id="btn-datos" class="nav-btn active" onclick="showSection('datos')">DATOS</button>
        <button id="btn-mapa" class="nav-btn" onclick="showSection('mapa')">MAPAS</button>
    </nav>
</div>

<script>
const LAT = 40.342, LON = -3.831;
let weatherData = null;

const weatherIcons = {
    0: "‚òÄÔ∏è", 1: "üå§Ô∏è", 2: "‚õÖ", 3: "‚òÅÔ∏è", 45: "üå´Ô∏è", 48: "üå´Ô∏è", 
    51: "üå¶Ô∏è", 53: "üå¶Ô∏è", 55: "üåßÔ∏è", 61: "üåßÔ∏è", 63: "üåßÔ∏è", 65: "üåßÔ∏è", 
    71: "‚ùÑÔ∏è", 73: "‚ùÑÔ∏è", 75: "‚ùÑÔ∏è", 77: "‚ùÑÔ∏è", 80: "üå¶Ô∏è", 81: "üåßÔ∏è", 
    82: "‚õàÔ∏è", 85: "‚ùÑÔ∏è", 86: "‚ùÑÔ∏è", 95: "‚õàÔ∏è", 96: "‚õàÔ∏è", 99: "‚õàÔ∏è"
};

async function init() {
    try {
        const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&hourly=temperature_2m,apparent_temperature,precipitation,precipitation_probability,wind_speed_10m,wind_gusts_10m,weather_code&timezone=auto&forecast_days=2`);
        weatherData = await response.json();
        renderForecast(new Date().getHours().toString().padStart(2, '0') + ":00");
    } catch(e) { console.error("Error"); }
}

function showSection(s) {
    document.getElementById('section-list').style.display = s === 'datos' ? 'flex' : 'none';
    document.getElementById('section-map').style.display = s === 'mapa' ? 'block' : 'none';
    document.getElementById('btn-datos').classList.toggle('active', s === 'datos');
    document.getElementById('btn-mapa').classList.toggle('active', s === 'mapa');
}

function renderForecast(startTime) {
    const list = document.getElementById('forecast-list');
    let html = '';
    const h = weatherData.hourly;
    let idx = h.time.findIndex(t => t.includes(`T${startTime.split(':')[0]}:00`));
    if (idx === -1) idx = 0;

    for (let i = idx; i < idx + 5; i++) {
        if (!h.time[i]) break;
        const time = h.time[i].split('T')[1], 
              temp = Math.round(h.temperature_2m[i]), 
              feel = Math.round(h.apparent_temperature[i]), 
              prob = h.precipitation_probability[i],
              rain = h.precipitation[i], 
              wind = Math.round(h.wind_speed_10m[i]), 
              gusts = Math.round(h.wind_gusts_10m[i]);

        let cTemp = temp <= 5 ? '#60a5fa' : temp >= 28 ? '#fb923c' : '#ffffff';
        let cProb = '#38bdf8';
        let cWind = wind >= 30 ? '#ef4444' : wind >= 18 ? '#facc15' : '#ffffff';
        let cGust = gusts >= 40 ? '#ef4444' : gusts >= 25 ? '#facc15' : '#888';

        let risk = (gusts > 35 || prob > 40 || rain > 0.8) ? 'risk-high' : (gusts > 22 || prob > 15 || rain > 0.1) ? 'risk-med' : 'risk-low';

        let rainLarge = prob > 0 ? `${prob}%` : "--";
        let rainSmall = rain > 0 ? `${rain.toFixed(1)}<small style="font-size:0.5rem">mm</small>` : "";

        html += `
            <div class="hour-card ${risk}">
                <div class="data-block">
                    <span class="label">HORA</span>
                    <div class="time-block">
                        ${i===idx ? `<input type="time" value="${time}" onchange="renderForecast(this.value)">` : `<span>${time}</span>`}
                    </div>
                    <div class="weather-icon">${weatherIcons[h.weather_code[i]] || "üå§Ô∏è"}</div>
                </div>
                <div class="data-block">
                    <span class="label">TEMP</span>
                    <span class="val-big" style="color:${cTemp}">${temp}¬∞</span>
                    <span class="val-small" style="color:#4ade80">${feel}¬∞</span>
                </div>
                <div class="data-block">
                    <span class="label">LLUVIA</span>
                    <span class="val-big" style="color:${cProb}">${rainLarge}</span>
                    <span class="val-small" style="color:#60a5fa">${rainSmall}</span>
                </div>
                <div class="data-block">
                    <span class="label">VIENTO</span>
                    <span class="val-big" style="color:${cWind}">${wind}</span>
                    <span class="val-small" style="color:${cGust}">${gusts}</span>
                </div>
            </div>`;
    }
    list.innerHTML = html;
}
</script>
</body>
</html>